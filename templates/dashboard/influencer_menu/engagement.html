{% extends "base.html" %}

{% block title %}Engagement Metrics{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='components/dashboard/influencer_dashboard.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">
    <!-- Sidebar Menu -->
    <aside class="sidebar">
        <h3>Dashboard Menu</h3>
        <ul class="menu">
            <li><a href="{{ url_for('dashboard_boundary.engagement') }}" class="active">Engagement Metrics</a></li>
            <li><a href="{{ url_for('dashboard_boundary.followers') }}">Followers Forecast</a></li>
            <li><a href="{{ url_for('dashboard_boundary.network') }}">Network Visualization</a></li>
        </ul>
    </aside>

    <!-- Main Content -->
    <div class="dashboard-container">
        <h2>Engagement Metrics for {{ user['username'] }}</h2>
        <p>Track and visualize your engagement metrics over time.</p>

        {% if metrics %}
            <!-- Chart Section -->
            <canvas id="engagementChart" width="800" height="400"></canvas>
            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    const ctx = document.getElementById('engagementChart').getContext('2d');

                    // Prepare data dynamically from backend
                    const labels = {{ metrics|map(attribute='date')|list|tojson }};
                    const likes = {{ metrics|map(attribute='likes')|list|tojson }};
                    const comments = {{ metrics|map(attribute='comments')|list|tojson }};
                    const shares = {{ metrics|map(attribute='shares')|list|tojson }};
                    const followers = {{ metrics|map(attribute='followers')|list|tojson }};

                    // Initialize Chart.js
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [
                                {
                                    label: 'Likes',
                                    data: likes,
                                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                    borderColor: 'rgba(75, 192, 192, 1)',
                                    borderWidth: 1,
                                    tension: 0.4,
                                },
                                {
                                    label: 'Comments',
                                    data: comments,
                                    backgroundColor: 'rgba(192, 75, 75, 0.2)',
                                    borderColor: 'rgba(192, 75, 75, 1)',
                                    borderWidth: 1,
                                    tension: 0.4,
                                },
                                {
                                    label: 'Shares',
                                    data: shares,
                                    backgroundColor: 'rgba(75, 75, 192, 0.2)',
                                    borderColor: 'rgba(75, 75, 192, 1)',
                                    borderWidth: 1,
                                    tension: 0.4,
                                },
                                {
                                    label: 'Followers',
                                    data: followers,
                                    backgroundColor: 'rgba(153, 102, 255, 0.2)',
                                    borderColor: 'rgba(153, 102, 255, 1)',
                                    borderWidth: 1,
                                    tension: 0.4,
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'top',
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false,
                                }
                            },
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Date'
                                    }
                                },
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Engagement Count'
                                    }
                                }
                            }
                        }
                    });
                });
            </script>
        {% else %}
            <p class="no-data-warning">No engagement metrics available at the moment.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
