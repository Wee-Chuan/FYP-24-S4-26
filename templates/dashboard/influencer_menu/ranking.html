{% extends "base.html" %}
{% block title %}Network Position{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='components/dashboard/influencer_dashboard.css') }}">
    <style>
        #networkGraph {
            width: 100%;
            height: 600px;
            border: 1px solid #ccc;
        }
        .ranking-table table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .ranking-table th, .ranking-table td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }
        .ranking-table .ellipsis {
            text-align: center;
            font-style: italic;
            color: #666;
        }
        .ranking-table .current-user {
            background-color: #f0f8ff;
            font-weight: bold;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="dashboard-wrapper">
        <aside class="sidebar">
            <h3>Dashboard Menu</h3>
            <ul class="menu">
                <li><a href="{{ url_for('influencer_boundary.engagement_metrics') }}"><i class="fas fa-chart-line"></i> Engagement Metrics</a></li>
                <li><a href="{{ url_for('influencer_boundary.followers') }}"><i class="fas fa-users"></i> Followers Forecast</a></li>
                <li><a href="{{ url_for('influencer_boundary.network') }}"><i class="fas fa-network-wired"></i> Network Visualization</a></li>
                <li><a href="{{ url_for('influencer_boundary.ranking') }}" class="active"><i class="fas fa-trophy"></i>Network Position</a></li>

                </aside>

    <main class="main-content">
        <h1>Your Network Position</h1>

        <!-- Follower Bar Chart -->
        <section class="follower-chart">
            <h2>Comparison with other users: Followers Count</h2>
            <p>You have {{ user_followers }} followers. Based on other users having similar performance as you, below is their follower count compared to you:</p>
            <canvas id="followersChart"></canvas>
        </section>

        <!-- Insights Section -->
        <section class="insights">
            <h2>Insights</h2>
            <p><strong>Your score for Degree of Centrality after normalized with all users:</strong> {{ user_score }}</p>
            <p><strong>Your Rank:</strong> {{ user_rank }}</p>
            {% if not is_top_user %}
                <p><strong>Score Difference with Top User:</strong> {{ score_diff }}</p>
            {% endif %}
        </section>

        <!-- Ranking Table -->
        <section class="ranking-table">
            <h2>Ranking Table: The area you are positioning now</h2>
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Username</th>
                        <th>Score</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in ranking_table %}
                        {% if row.use_ellipsis %}
                            <tr>
                                <td colspan="3" class="ellipsis">{{ row.username }}</td>
                            </tr>
                        {% else %}
                            <tr class="{% if row.is_user %}current-user{% endif %}">
                                <td>{{ row.rank }}</td>
                                <td>{{ row.username }}</td>
                                <td>{{ row.score }}</td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </section>

        <script>
            var userIndex = {{ user_index | tojson }};
            var chartData = {{ chart_data | tojson }};
            var ctx = document.getElementById('followersChart').getContext('2d');
            var chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.labels_nearby,
                    datasets: [{
                        label: 'Followers Count of users with similar rankings ',
                        data: chartData.followers_nearby,
                        backgroundColor: chartData.labels_nearby.map((_, index) => index === userIndex ? '#FF5733' : '#58D68D'),
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        </script>
    </main>
</div>
{% endblock %}