{% extends "base.html" %}
{% block title %}About Us - SocioSith{% endblock %}
{% set show_nav = True %}

{% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='components/forms/about.css') }}">
{% endblock %}

{% block content %}
<div class="about-us-wrapper">

    <div class="about-us-container">
        <!-- Section for Overview -->
        <section class="overview">
            <!-- Title of the About Us section, from the 'overview_content_about_us' object -->
            <h1>{{overview_content_about_us['title']}}</h1>

            <!-- First paragraph of the About Us section -->
            <p>{{overview_content_about_us['paragraph']}}</p>
            
            <!-- Second paragraph of the About Us section -->
            <p>{{overview_content_about_us['paragraph2']}}</p>
        </section>

         <!-- Section for Goals -->
        <section class="goals">
            <!-- Heading for the Goals section, from the 'goals_heading' object -->
            <h2>{{goals_heading['heading']}}</h2>

            <!-- Container for displaying multiple goals -->
            <div class="goal-container">
                <!-- Loop through all goals in the 'our_goals' collection -->
                {% for goal in our_goals %}
                <div class="goal-block">
                    <!-- Display the icon associated with each goal using 'goal.icon' -->
                    <i class="{{ goal['icon'] }} goal-icon"></i> 

                    <!-- Title of the goal -->
                    <h3>{{ goal['title'] }}</h3>

                    <!-- Description of the goal -->
                    <p>{{ goal['description'] }}</p>
                </div>
                {% endfor %}
            </div>
        </section>

        <!-- Section for Testimonials -->
        <section class="testimonials">
            <h2>Customer Testimonials</h2>
            <div class="testimonial-carousel">
                <!-- Button to show the previous testimonial -->
                <button class="carousel-button left" onclick="showPreviousReview()">&#9664;</button>
                
                <!-- Block to display the current testimonial -->
                {% if reviews %}
                    <div class="carousel-item active">
                        <blockquote id="testimonial-text">
                            <!-- First review is shown by default -->
                            <p>
                                <strong>{{ reviews[0].username }}</strong>
                                <!-- Loop to generate star icons for the rating -->
                                <span id="rating-stars">{% for i in range(reviews[0].rating|int) %}<i class="fas fa-star"></i>{% endfor %}</span>
                            </p>
                            <p>"{{ reviews[0].review }}"</p>
                        </blockquote>
                    </div>
                {% else %}
                    <!-- Fallback message if no reviews are available -->
                    <div class="carousel-item active">
                        <blockquote id="testimonial-text">
                            No reviews available at the moment.
                        </blockquote>
                    </div>
                {% endif %}
                
                <!-- Button to show the next testimonial -->
                <button class="carousel-button right" onclick="showNextReview()">&#9654;</button>
            </div>
        </section>
    </div>
</div>
<script>
    // Array of testimonials, dynamically populated from server-side data
    const testimonials = [
        {% for review in reviews %}
            {   
                // The review text
                text: "{{ review.review }}",
                // The reviewer's username
                author: "{{ review.username }}",
                // The rating (number of stars)
                rating: "{{ review.rating }}"
            }{% if not loop.last %},{% endif %}
        {% endfor %}
    ];

    // Current index of the testimonial being displayed
    let currentIndex = 0;
        
    // Function to update the testimonial content
    function updateTestimonial() {
        // Select the blockquote element to update its content
        const testimonialText = document.getElementById('testimonial-text');
        // Get the current testimonial data
        const currentTestimonial = testimonials[currentIndex];

        // Generate star icons for the rating
        let stars = '';
        for (let i = 0; i < parseInt(currentTestimonial.rating); i++) {
            stars += '<i class="fas fa-star"></i>';
        }

        // Update the testimonial content with the text, author, and stars
        testimonialText.innerHTML = `<p><strong>${currentTestimonial.author}</strong> </p>
                                     <p><span id="rating-stars">${stars}</span></p>
                                     <p>"${currentTestimonial.text}"</p>`;

        // Reset and reapply the active class for a fade-in effect
        testimonialText.classList.remove('active');
        setTimeout(() => testimonialText.classList.add('active'), 10);
    }

    // Function to show the next testimonial in the carousel
    function showNextReview() {
        // Increment the index, wrapping around if at the end
        currentIndex = (currentIndex + 1) % testimonials.length;
        updateTestimonial(); // Update the displayed testimonial
    }

    // Function to show the previous testimonial in the carousel
    function showPreviousReview() {
        // Decrement the index, wrapping around if at the beginning
        currentIndex = (currentIndex - 1 + testimonials.length) % testimonials.length;
        updateTestimonial(); // Update the displayed testimonial
    }

    // Initialize the first testimonial when the page is loaded
    document.addEventListener("DOMContentLoaded", updateTestimonial);
</script>
{% endblock %}


</body>
</html>